<Window
    x:Class="icp_winui3.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    mc:Ignorable="d"
    Title="ICP 点云合并工具">

    <Grid RowDefinitions="Auto,*,Auto"
          Padding="16"
          Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

        <!-- ===== Header ===== -->
        <StackPanel Grid.Row="0" Spacing="4">
            <TextBlock Text="ICP 点云合并"
                       FontSize="20"
                       FontWeight="SemiBold"/>
            <TextBlock Text="选择包含 ASC 文件的文件夹，自动执行多帧 ICP 并合并点云"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       FontSize="13"/>
        </StackPanel>

        <!-- ===== Content ===== -->
        <Border Grid.Row="1"
                Margin="0,16"
                Padding="16"
                CornerRadius="8"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
            <Grid RowDefinitions="Auto,*">
                <StackPanel Grid.Row="0" Spacing="12">

                    <Button x:Name="ActionButton"
                        Content="选择文件夹 / 开始处理"
                        HorizontalAlignment="Center"
                        MinWidth="200"
                        Height="36"
                        Click="ActionButton_Click"/>

                    <TextBlock x:Name="StatusTextBlock"
                           Text="状态：就绪"
                           TextWrapping="Wrap"
                           FontSize="14"
                           Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>

                </StackPanel>
                <canvas:CanvasControl
                Grid.Row="1"
                x:Name="PointCanvas"
                ClearColor="#44FFCC99"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Draw="PointCanvas_Draw"/>
            </Grid>
        </Border>

        <!-- ===== Footer ===== -->
        <StackPanel Grid.Row="2" Spacing="8">

            <ProgressBar x:Name="ProgressBar"
                         Height="6"
                         Minimum="0"
                         Maximum="100"
                         Visibility="Collapsed"/>

            <StackPanel Orientation="Horizontal"
                        Spacing="8"
                        VerticalAlignment="Center">

                <ProgressRing x:Name="BusyRing"
                              Width="20"
                              Height="20"
                              IsActive="False"
                              Visibility="Collapsed"/>

                <TextBlock Text="处理中…"
                           Visibility="{x:Bind BusyRing.Visibility}"
                           FontSize="12"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

            </StackPanel>

        </StackPanel>

    </Grid>
</Window>
